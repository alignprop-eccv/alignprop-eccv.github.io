<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta charset="utf-8">
  <meta property="og:title" content="Align-Prop" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="628" />

  <meta name="viewport" content="initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1">



  <title>Align-Prop</title>
  <link rel="stylesheet" href="./static/css//range_style_new.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">
  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet"href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="stylesheet" href="https://use.typekit.net/iag3ven.css">
  <link rel="stylesheet" href="./static/css/prism.css">

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’«</text></svg>">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.0.1/prism-bibtex.min.js">
  </script>  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script> 


  
  
</head>

<body>

  


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-2 publication-title">Aligning Text-to-Image Diffusion Models with Reward Backpropagation</h1>
          <div class="is-size-5 publication-authors">
            <span class="author-block has-text-weight-semibold">
              Anonymous Authors</span>
              </div>

              <div class="column has-text-centered">
                <div class="publication-links">
                  <!-- Code Link. -->
                  <span class="link-block">
                    <a href="https://github.com/anonymum/AlignProp_Anon"
                       class="external-link button is-normal is-rounded is-dark">
                      <span class="icon">
                          <i class="fab fa-github"></i>
                      </span>
                      <span>Code</span>
                      </a>
                  </span>
                </div>
              </div>              
          
        </div>
      </div>
    </div>
  </div>
</section>

<section class="hero teaser">
  <!-- <div class="container is-max-desktop"> -->
    <div class="is-centered has-text-centered">
    <div class="hero-body ">

      <!-- Poster. -->
      <!-- <div class="columns mt-4"> -->

        <video   width="1100" autoplay muted>
          <source src="promo2.m4v" type="video/mp4">
          Your browser does not support the video tag.
      </video>

      <!-- </div>    -->
      

      <h2 class="pt-1 container is-max-desktop subtitle has-text-centered">
        AlignProp is a direct backpropagation-based approach to finetune text-to-image diffusion models for desired reward function. Above we show finetuning results for various reward functions. 
      </h2> 
    <!--/ Poster. -->
    </div>
  <!-- </div> -->
  </div>
</section>


<section class="section pt-2">
  <div class="container is-max-desktop">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3 p">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Text-to-image diffusion models have recently emerged at the forefront of image generation, powered by very large-scale unsupervised or weakly supervised text-to-image training datasets.  Due to the unsupervised   training,  controlling  their behavior in downstream tasks, such as maximizing human-perceived image quality,  image-text alignment, or ethical image generation, is difficult. Recent works finetune diffusion models to downstream reward functions using vanilla reinforcement learning, notorious for the high variance of the gradient estimators. In this paper, we propose AlignProp, a method that aligns diffusion models to downstream reward functions using end-to-end backpropagation of the reward gradient through the denoising process. While naive implementation of such backpropagation would require prohibitive memory resources for storing the partial derivatives of modern text-to-image models, AlignProp finetunes low-rank adapter weight modules and uses gradient checkpointing, to render its memory usage viable. We test AlignProp in finetuning diffusion models to various objectives, such as image-text semantic alignment, aesthetics, compressibility and controllability of the number of objects present, as well as their combinations.  We show AlignProp  achieves higher rewards in fewer training steps than alternatives, while being conceptually simpler, making it a straightforward choice for optimizing diffusion models for differentiable reward functions of interest. 
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- / Method Overview -->

<!-- Results Overview -->
<section class="section">
  <div class="container is-max-widescreen">
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title pt-5 pb-2 has-text-centered">Comparision with baselines at different epochs during training.</h2>
        <h3 class="pb-4 is-size-4">In the results below we compare AlignProp with all other baselines, during different iterations of training. A single iteration of training represents a single step of gradient descent. As can be seen
          from the visuals, DDPO is very sample inefficient, it rarely shows any improvements from the Stable Diffusion generations. ReFL while being sample efficient doesn't result in changes at a semantic level, also it results in overoptimization at training iteration 14.
        </h3>
        
        <div  class="content has-text-justified">
          <video   width="1200" autoplay muted loop>
            <source src="epoch_aesthetic.m4v" type="video/mp4">
              Your browser does not support the video tag.
        </video>          
        <h2 class="title pt-5 has-text-centered is-size-4"><a href="https://wandb.ai/alignprop-eccv/alignprop-eccv/reports/Aesthetics-Results-different-Epochs---Vmlldzo3MTI1OTcw?accessToken=l7f5zvdnrrdqr7xq6rhiwiikdzkbj4dzjfvzdzjy73ptcd04qiizqyekfr7snymv"><-----------Click here for More Results on Aesthetic Reward---------></a></h2>
          <!-- <iframe src="https://wandb.ai/alignprop-eccv/alignprop-eccv/reports/Aesthetics-Results-different-Epochs---Vmlldzo3MTI1OTcw" style="border:none;height:512px;width:100%"></iframe> -->
        </div>

      </div>    
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-widescreen">
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title pt-5 pb-2 has-text-centered">Comparision with baselines on HPS reward</h2>
        <h3 class="pb-4 is-size-4">In the results below we compare AlignProp with all other baselines for image-text alignment, while using HPSv2 reward function.
        </h3>

        <h3 class="title is-size-4">A pair of planes parked in a small rural airfield.</h3>
        <div class="columns">
        
            <div class="column">
                <h1 class="title is-size-5">Stable Diffusion</h1>
                <img src="finals/stablediffusion_reduced/eval_vis/016_A pair of planes parked in a small rural airfield..png" alt="016_A pair of planes parked in a small rural airfield..png">
            </div>
            
            <div class="column">
                <h1 class="title is-size-5">DDPO</h1>
                <img src="finals/DDPO_reduced/eval_vis/016_A pair of planes parked in a small rural airfield..png" alt="016_A pair of planes parked in a small rural airfield..png">
            </div>
            
            <div class="column">
                <h1 class="title is-size-5">ReFL</h1>
                <img src="finals/refl_main_reduced/eval_vis/016_A pair of planes parked in a small rural airfield..png" alt="016_A pair of planes parked in a small rural airfield..png">
            </div>
            
            <div class="column">
                <h1 class="title is-size-5">AlignProp</h1>
                <img src="finals/alignprop_reduced/eval_vis/016_A pair of planes parked in a small rural airfield..png" alt="016_A pair of planes parked in a small rural airfield..png">
            </div>
            
        </div>   
        
        
        <h1 class="title is-size-4">A bunch of people on skiing on a hill</h1>
        <div class="columns">
        
            <div class="column">
                <h1 class="title is-size-5">Stable Diffusion</h1>
                <img src="finals/stablediffusion_reduced/eval_vis/073_a bunch of people on skiing on a hill.png" alt="073_a bunch of people on skiing on a hill.png">
            </div>
            
            <div class="column">
                <h1 class="title is-size-5">DDPO</h1>
                <img src="finals/DDPO_reduced/eval_vis/073_a bunch of people on skiing on a hill.png" alt="073_a bunch of people on skiing on a hill.png">
            </div>
            
            <div class="column">
                <h1 class="title is-size-5">ReFL</h1>
                <img src="finals/refl_main_reduced/eval_vis/073_a bunch of people on skiing on a hill.png" alt="073_a bunch of people on skiing on a hill.png">
            </div>
            
            <div class="column">
                <h1 class="title is-size-5">AlignProp</h1>
                <img src="finals/alignprop_reduced/eval_vis/073_a bunch of people on skiing on a hill.png" alt="073_a bunch of people on skiing on a hill.png">
            </div>
            
        </div>  
        
        <h2 class="title pt-5 has-text-centered is-size-4"><a href="hps.html"><-----------Click here for More Results on HPS Reward---------></a></h2>

      </div>    
    </div>
  </div>
</section>


<section class="section">
  <div class="container is-max-widescreen">
    <div class="columns is-centered">
      <div class="column is-full-width">
        <h2 class="title pb-2 is-3 has-text-centered">Interactive Mixing Results</h2>

        <h3 class="pb-4 is-size-4">
          In this context, we demonstrate the ability of AlignProp to interpolate between different reward functions during the inference phase. We draw inspiration from the concept presented in <a href="https://arxiv.org/abs/2203.05482">ModelSoup</a>, which showcases how averaging the weights of multiple fine-tuned models can enhance image classification accuracy.Expanding upon this idea, we extend it to the domain of image editing, revealing that averaging the LoRA weights of diffusion models trained with distinct reward functions can yield images that satisfy multiple reward criteria. AlignProp adeptly demonstrates its capacity to interpolate between distinct reward functions, achieving the highest overall reward when the mixing coefficient is set to 0.5. 
          <strong>Please move the slider to visualize results with different mixing coefficients.</strong>
        </h3>
 
      <div class="pt-4 columns mb-0 is-vcentered  has-text-centered">
          <div  class="column">
            <h2 class="is-size-5">Aesthetic Model</h2>
            <img src="./animals/spider/0.png"
                class="interpolation-image"
                alt="Seg Acc Curve."/>       
          </div>        
          <div  class="column" id="interpolation-ex3-wrapper">
            <h2 class="is-size-5">Hybrid Model</h2>
            <img src="./animals/spider/5.png"
                 class="interpolation-image"
                 alt="Seg Acc Curve."/>       
          </div>
          <div  class="column">
            <h2 class="is-size-5">Compression Model</h2>
            <img src="./animals/spider/10.png"
                 class="interpolation-image"
                 alt="Seg Acc Curve."/>       
          </div>          
      </div>

      <div class="pt-0 columns mb-0 is-vcentered  has-text-centered">
        <div  class="column">
          <h2 class="is-size-5">Aesthetic Model</h2>
          <img src="./animals/sheep/0.png"
              class="interpolation-image"
              alt="Seg Acc Curve."/>       
        </div>        
        <div  class="column" id="interpolation-ex4-wrapper">
          <h2 class="is-size-5">Hybrid Model</h2>
          <img src="./animals/sheep/5.png"
               class="interpolation-image"
               alt="Seg Acc Curve."/>       
        </div>
        <div  class="column">
          <h2 class="is-size-5">Compression Model</h2>
          <img src="./animals/sheep/10.png"
               class="interpolation-image"
               alt="Seg Acc Curve."/>       
        </div>          
    </div>

      <!-- <section class="all-sliders"> -->
        <!-- <label>
          <input class="slider" id="range-slider" type="range" min="1" step="0.01" max="100" value="80">
        </label> -->
      <!-- </section>       -->
      <div class="columns pt-5">
        <div class="column is-half is-offset-one-quarter">
      
      <div class="columns  is-vcentered">

        <div class="column is-11 pr-0 pl-0 ml-0 mr-0 has-text-centered" id="slider-container">
          <!-- <label>
          <input class="slider" id="range-slider-poster" type="range" min="1" step="1" max="265" value="0">          
        </label> -->
        <input class="is-fullwidth is-large is-info" id="range-slider-poster" name="slider" type="range" value=5>
              
          <!-- <input class="slider is-fullwidth is-large is-info"
                 id="interpolation-slider"
                 step="1" min="0" max="265" value="0" type="range">     -->
        </div>        
        <div class="column pr-0 pl-0 ml-0 mr-0">
          <label for="slider">0.5</label>

        </div>
        
      </div>
    </div>
  </div>

      <h2 class="subtitle has-text-centered">
        Hybrid Model - Mixing Coefficient (&alpha;)
      </h2>


      </div>
    </div>
</div>
</section>


<!-- / Results Overview -->

<section class="section" id="paper">
  <div class="container is-mobile">
      <div class="columns is-centered has-text-centered">
      </div>
  </div>
</section>


<script src="./static/js/index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.0.1/prism-bibtex.js"
    integrity="sha256-+dK6uqUp/DnP6ef97s8XcoynBnGe5vM5gvBECH0EB3U=" crossorigin="anonymous">
    </script>
</body>
</html>
